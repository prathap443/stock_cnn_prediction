<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trade {{ symbol }} - Stock Analytics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow-lg">
      <div class="card-header bg-primary text-white">
        <h3 class="mb-0">Trade {{ symbol }}</h3>
      </div>
      <div class="card-body">
        <h5>Current Price: <span class="text-success">${{ current_price }}</span></h5>
        <form id="trade-form">
          <div class="mb-3">
            <label for="qty" class="form-label">Quantity</label>
            <input type="number" class="form-control" id="qty" name="qty" value="1" min="1" required>
          </div>

          <div class="mb-3">
            <label for="side" class="form-label">Action</label>
            <select class="form-select" id="side" name="side" required>
              <option value="buy" selected>Buy</option>
              <option value="sell">Sell</option>
            </select>
          </div>

          <input type="hidden" id="symbol" name="symbol" value="{{ symbol }}">

          <button type="submit" class="btn btn-success">Place Order</button>
          <a href="/" class="btn btn-secondary ms-2">Cancel</a>
        </form>

        <div id="result" class="mt-4"></div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("trade-form").addEventListener("submit", async function(event) {
      event.preventDefault();
      const resultDiv = document.getElementById("result");

      const data = {
        symbol: document.getElementById("symbol").value,
        qty: document.getElementById("qty").value,
        side: document.getElementById("side").value
      };

      try {
        const response = await fetch("/trade", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        if (response.ok) {
          resultDiv.innerHTML = `<div class="alert alert-success">✅ ${result.status || 'Order placed successfully!'}</div>`;
        } else {
          resultDiv.innerHTML = `<div class="alert alert-danger">❌ ${result.error || 'Failed to place order.'}</div>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<div class="alert alert-danger">❌ ${err.message}</div>`;
      }
    });
  </script>
</body>
</html>
